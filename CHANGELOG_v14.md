# Changelog - –ò—Ç–µ—Ä–∞—Ü–∏—è 14

## üéØ –û—Å–Ω–æ–≤–Ω–∏ –æ–ø—Ä–∞–≤–µ–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏

### 1. ‚úÖ AI –º–æ–¥–µ–ª–∞ –Ω–µ —Å–µ —Å–º–µ–Ω—è—à–µ
**–ü—Ä–µ–¥–∏:**
- –í—ä–ø—Ä–µ–∫–∏ –∏–∑–±–æ—Ä–∞ –Ω–∞ –º–æ–¥–µ–ª –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –≤–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞—à–µ GitHub Spark –≤–≥—Ä–∞–¥–µ–Ω–∏—è `gpt-4o`
- –°–æ–±—Å—Ç–≤–µ–Ω–∏—è—Ç API –∫–ª—é—á —Å–µ –∏–≥–Ω–æ—Ä–∏—Ä–∞—à–µ
- Gemini –º–æ–¥–µ–ª–∏—Ç–µ –Ω–µ –º–æ–∂–µ—Ö–∞ –¥–∞ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç

**–°–µ–≥–∞:**
- –°—ä–∑–¥–∞–¥–µ–Ω–∞ –µ —Ñ—É–Ω–∫—Ü–∏—è `callExternalAPI()` –∫–æ—è—Ç–æ –¥–∏—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–∏–∫–≤–∞ OpenAI –∏–ª–∏ Gemini API
- –†–µ–∞–ª–Ω–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∏–∑–±—Ä–∞–Ω–∏—è—Ç –º–æ–¥–µ–ª –∏ API –∫–ª—é—á –æ—Ç –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∞
- –ü—ä–ª–Ω–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞:
  - OpenAI: gpt-4o, gpt-4o-mini, gpt-4-turbo
  - Google Gemini: gemini-2.0-flash-exp, gemini-1.5-pro, gemini-1.5-flash

### 2. ‚úÖ –¢–≤—ä—Ä–¥–µ –º–Ω–æ–≥–æ –∑–∞—è–≤–∫–∏ (Rate Limit 429)
**–ü—Ä–µ–¥–∏:**
- –ò–∑—á–∞–∫–≤–∞–Ω–µ —Å–∞–º–æ 15 —Å–µ–∫—É–Ω–¥–∏ –º–µ–∂–¥—É –∑–∞—è–≤–∫–∏—Ç–µ
- –ß–µ—Å—Ç–æ —Å–µ –ø–æ–ª—É—á–∞–≤–∞—Ö–∞ "Too many requests" –≥—Ä–µ—à–∫–∏
- Rate limit —Å–µ –¥–æ—Å—Ç–∏–≥–∞—à–µ —Å–ª–µ–¥ 2-3 –∞–Ω–∞–ª–∏–∑–∞

**–°–µ–≥–∞:**
- –£–≤–µ–ª–∏—á–µ–Ω–æ –∏–∑—á–∞–∫–≤–∞–Ω–µ –Ω–∞ **30 —Å–µ–∫—É–Ω–¥–∏** –∑–∞ GitHub Spark –º–æ–¥–µ–ª
- –ü—Ä–∏ —Å–æ–±—Å—Ç–≤–µ–Ω API –∫–ª—é—á - —Å–∞–º–æ **5 —Å–µ–∫—É–Ω–¥–∏** –∏–∑—á–∞–∫–≤–∞–Ω–µ
- –ü–æ–¥–æ–±—Ä–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞ —Å –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–µ–Ω backoff
- –ü—Ä–∏ rate limit - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑—á–∞–∫–≤–∞–Ω–µ 90 —Å–µ–∫—É–Ω–¥–∏

### 3. ‚úÖ –ù–µ–≤–∞–ª–∏–¥–µ–Ω JSON –æ—Ç–≥–æ–≤–æ—Ä
**–ü—Ä–µ–¥–∏:**
- AI –º–æ–¥–µ–ª—ä—Ç –ø–æ–Ω—è–∫–æ–≥–∞ –≤—Ä—ä—â–∞—à–µ JSON —Å –Ω–µ–∑–∞—Ç–≤–æ—Ä–µ–Ω–∏ –∫–∞–≤–∏—á–∫–∏
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –∫—Ä–∞—à–≤–∞—à–µ –ø—Ä–∏ "Unterminated string in JSON"
- –õ–∏–ø—Å–≤–∞—Ö–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∏ –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏

**–°–µ–≥–∞:**
- –ü–æ–¥–æ–±—Ä–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `robustJSONParse()` —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –Ω–∏–≤–∞ –Ω–∞ –ø–æ–ø—Ä–∞–≤–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –Ω–µ–∑–∞—Ç–≤–æ—Ä–µ–Ω–∏ —Å–∫–æ–±–∏ –∏ –∫–∞–≤–∏—á–∫–∏
- –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∏ —Å–∏–º–≤–æ–ª–∏
- –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ JSON –æ—Ç —Ç–µ–∫—Å—Ç —Å markdown
- –ê–≥—Ä–µ—Å–∏–≤–Ω–∞ –ø–æ–ø—Ä–∞–≤–∫–∞ –∫–∞—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∞ –æ–ø—Ü–∏—è

---

## üöÄ –ù–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏

### –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ –≤—ä–Ω—à–Ω–∏ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏
- –î–∏—Ä–µ–∫—Ç–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API
- –î–∏—Ä–µ–∫—Ç–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Gemini API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–±–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—è endpoint —Å–ø–æ—Ä–µ–¥ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ü—Ä–∞–≤–∏–ª–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ requests –∑–∞ –≤—Å–µ–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä

### –ü–æ–¥–æ–±—Ä–µ–Ω–æ –ª–æ–≥–≤–∞–Ω–µ
```typescript
addLog('info', `üîß –†–µ–∂–∏–º: –°–æ–±—Å—Ç–≤–µ–Ω API (${provider} - ${model})`)
addLog('info', `üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: Provider=${provider}, Model=${model}, CustomKey=${!!useCustomKey}`)
addLog('info', `üîë –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω API: ${provider} / ${model}`)
```

### –í–∏–∑—É–∞–ª–Ω–∏ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è –≤ Admin –ø–∞–Ω–µ–ª–∞
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞ –∞–∫—Ç–∏–≤–Ω–∞—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –≥–æ—Ä–Ω–∞—Ç–∞ —á–∞—Å—Ç
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ø—Ä–µ–¥–∏–º—Å—Ç–≤–∞—Ç–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω API –∫–ª—é—á
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ GitHub Spark –º–æ–¥–µ–ª
- –î–∏–Ω–∞–º–∏—á–Ω–æ –≤—Ä–µ–º–µ –∑–∞ –∞–Ω–∞–ª–∏–∑ —Å–ø–æ—Ä–µ–¥ –∏–∑–±—Ä–∞–Ω–∏—è —Ä–µ–∂–∏–º

---

## üìä –í—Ä–µ–º–µ–Ω–∞ –∑–∞ –∞–Ω–∞–ª–∏–∑

| –†–µ–∂–∏–º | –í—Ä–µ–º–µ | –ó–∞–±–µ–ª–µ–∂–∫–∏ |
|-------|-------|-----------|
| GitHub Spark (–±–µ–∑ API –∫–ª—é—á) | 90-150 —Å–µ–∫ | 4 –∑–∞—è–≤–∫–∏ √ó 30 —Å–µ–∫ –∏–∑—á–∞–∫–≤–∞–Ω–µ + 10-30 —Å–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| –°–æ–±—Å—Ç–≤–µ–Ω API –∫–ª—é—á | 30-60 —Å–µ–∫ | 4 –∑–∞—è–≤–∫–∏ √ó 5 —Å–µ–∫ –∏–∑—á–∞–∫–≤–∞–Ω–µ + 5-10 —Å–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∞ |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–æ–º–µ–Ω–∏

### –ù–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `AnalysisScreen.tsx`

#### `callExternalAPI()`
```typescript
const callExternalAPI = async (
  prompt: string,
  provider: 'openai' | 'gemini',
  model: string,
  apiKey: string,
  jsonMode: boolean = true
): Promise<string>
```
- –û–±—Ä–∞–±–æ—Ç–≤–∞ OpenAI –∏ Gemini API –∑–∞—è–≤–∫–∏
- –ü—Ä–∞–≤–∏–ª–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ requests
- Error handling —Å —è—Å–Ω–∏ —Å—ä–æ–±—â–µ–Ω–∏—è

#### –ü–æ–¥–æ–±—Ä–µ–Ω–∞ `callLLMWithRetry()`
```typescript
const callLLMWithRetry = async (
  prompt: string,
  modelName: string = 'gpt-4o',
  jsonMode: boolean = true,
  maxRetries: number = 3
): Promise<string>
```
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω API
- –†–∞–∑–ª–∏—á–Ω–∏ backoff –≤—Ä–µ–º–µ–Ω–∞ —Å–ø–æ—Ä–µ–¥ —Ä–µ–∂–∏–º–∞
- –õ–æ–≥–≤–∞–Ω–µ –Ω–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∞—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∏–∑—á–∞–∫–≤–∞–Ω–∏—è

**–ü—Ä–∏ GitHub Spark –º–æ–¥–µ–ª:**
```typescript
const waitTime = aiConfig?.useCustomKey ? 5000 : 30000
await sleep(waitTime)
```

**–ü—Ä–∏ rate limit:**
```typescript
const backoffTime = useCustomAPI ? 10000 : 90000
await sleep(backoffTime)
```

### –ü–æ–¥–æ–±—Ä–µ–Ω–∏—è –≤ Admin –ø–∞–Ω–µ–ª–∞

**–í–∏–∑—É–∞–ª–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä:**
```typescript
{aiConfig && (
  <div className="mt-3 p-3 bg-primary/10 rounded-lg border border-primary/20">
    <p className="text-sm font-medium text-primary">
      ‚úì –ê–∫—Ç–∏–≤–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: {aiConfig.useCustomKey ? (
        <span className="font-mono">{aiConfig.provider} / {aiConfig.model}</span>
      ) : (
        <span className="font-mono">GitHub Spark (–≤–≥—Ä–∞–¥–µ–Ω –º–æ–¥–µ–ª)</span>
      )}
    </p>
  </div>
)}
```

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–æ–±–∞–≤–µ–Ω–∏ –Ω–æ–≤–∏ —Ñ–∞–π–ª–æ–≤–µ:
- `AI_CONFIGURATION_GUIDE.md` - –ü—ä–ª–Ω–æ —Ä—ä–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω `PRD.md` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ò—Ç–µ—Ä–∞—Ü–∏—è 14

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **GitHub Spark rate limit** - –í—Å–µ –æ—â–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –ø—Ä–∏ –∏–Ω—Ç–µ–Ω–∑–∏–≤–Ω–∞ —É–ø–æ—Ç—Ä–µ–±–∞ –±–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω API –∫–ª—é—á
2. **JSON –≥—Ä–µ—à–∫–∏** - –ú–∞–∫–∞—Ä –∏ —Ä—è–¥–∫–æ, –≤—Å–µ –æ—â–µ –µ –≤—ä–∑–º–æ–∂–Ω–æ –ø—Ä–∏ –º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏
3. **API keys security** - API –∫–ª—é—á–æ–≤–µ—Ç–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –≤ KV store (–ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ —Å–µ encryption –≤ –ø—Ä–æ–¥—É–∫—Ü–∏—è)

---

## üí° –ü—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ

1. **–í–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω API –∫–ª—é—á** –∑–∞ –ø–æ-–¥–æ–±—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç
2. **–ò–∑–±–µ—Ä–µ—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â –º–æ–¥–µ–ª:**
   - –¢–µ—Å—Ç–≤–∞–Ω–µ: `gpt-4o-mini` –∏–ª–∏ `gemini-1.5-flash`
   - –ü—Ä–æ–¥—É–∫—Ü–∏—è: `gpt-4o` –∏–ª–∏ `gemini-1.5-pro`
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ä–∞–π—Ç–µ –ª–æ–≥–æ–≤–µ—Ç–µ** –∑–∞ –ø—Ä–æ–±–ª–µ–º–∏ —Å API
4. **–ü—Ä–æ–≤–µ—Ä—è–≤–∞–π—Ç–µ API –ª–∏–º–∏—Ç–∏—Ç–µ** –≤ —Å—ä–æ—Ç–≤–µ—Ç–Ω–∏—è dashboard

---

## üéØ –°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏ (Suggestions)

1. **–î–æ–±–∞–≤–µ—Ç–µ –ø–æ–≤–µ—á–µ AI –º–æ–¥–µ–ª–∏** - Claude, Mistral, LLaMA
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º system prompt** - –û—Ç –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∞
3. **PDF export** - –ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –¥–æ–∫–ª–∞–¥–∏ –∫–∞—Ç–æ PDF

---

**–î–∞—Ç–∞:** 2024
**–í–µ—Ä—Å–∏—è:** –ò—Ç–µ—Ä–∞—Ü–∏—è 14
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
